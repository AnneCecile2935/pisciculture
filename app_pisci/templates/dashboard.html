{% extends "base.html" %}
{% block title %}Tableau de bord - Température{% endblock %}
{% block content %}
<div class="container-fluid my-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Température (°C) par site (2 dernières semaines)</h5>
        </div>
        <div class="card-body">
            <div class="chart-container" style="position: relative; height:400px;">
                <canvas id="temperatureChart"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const isDarkMode = document.body.hasAttribute('data-theme') &&
                       document.body.getAttribute('data-theme') === 'dark';

    const lightColors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#8AC24A', '#607D8B'];
    const darkColors = ['#FF8A80', '#82B1FF', '#FFD740', '#64FFDA', '#E57373', '#FFB74D', '#AED581', '#90A4AE'];

    fetch("{% url 'activite_quotidien:temperature-chart-data' %}")
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('temperatureChart').getContext('2d');

            // Applique les couleurs en fonction du thème
            data.datasets.forEach((dataset, index) => {
                dataset.borderColor = isDarkMode ? darkColors[index % darkColors.length] : lightColors[index % lightColors.length];
            });

            const chart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw + ' °C';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Date' },
                            grid: {
                                color: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: isDarkMode ? 'white' : 'black'
                            }
                        },
                        y: {
                            title: { display: true, text: 'Température (°C)' },
                            suggestedMin: 10,
                            suggestedMax: 30,
                            grid: {
                                color: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                color: isDarkMode ? 'white' : 'black'
                            }
                        }
                    }
                }
            });

            // Écouteur pour le changement de thème
            document.getElementById('theme-toggle').addEventListener('click', function() {
                const newIsDarkMode = document.body.getAttribute('data-theme') === 'dark';

                chart.data.datasets.forEach((dataset, index) => {
                    dataset.borderColor = newIsDarkMode ? darkColors[index % darkColors.length] : lightColors[index % lightColors.length];
                });

                chart.options.scales.x.grid.color = newIsDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                chart.options.scales.x.ticks.color = newIsDarkMode ? 'white' : 'black';
                chart.options.scales.y.grid.color = newIsDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                chart.options.scales.y.ticks.color = newIsDarkMode ? 'white' : 'black';

                chart.update();
            });
        })
        .catch(error => console.error('Erreur:', error));
});
</script>
{% endblock %}
